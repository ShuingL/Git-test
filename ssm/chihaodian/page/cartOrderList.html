

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<title>订单</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/shoujisc.css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

<link rel="stylesheet" type="text/css" href="css/showTip.css">
<script type="text/javascript" src="js/showTip.js"></script>
<script type="text/javascript" src="js/area.js"></script>
<script type="text/javascript">
$(function(){
	showStr("province","city","area");
});
</script>

</head>

<body id="wrap">
	
    <div class="sjsc-title2">
    	<h3 class="sjsc-t2l">订单</h3>
        <a href="cartList.html" class="sjsc-t2r"><img src="images/back.png" alt="" style="width:20px;height: 20px;padding-top: 11px;padding-left: 5px"/></a>
    </div>
     <input type="hidden" value="0" id='addr_id'>
       
    <dl class="drdd-info6" onclick="window.location.href='addrList.html?cps_id=0&addr_id=0'">
      
       
		<dt style="padding-top:15px;margin-left:10px">
        	
         <span class="f-l" >点击添加收货地址</span>
            	
              
        </dt>
		
        <dd><a>></a></dd>
        <div style="clear:both;"></div>
    </dl>
    
    
    <input type="hidden" value="0" id='tnum'>
    <input type="hidden" value="6.0" id='tprice'>
      <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E">
  	 商品信息
    </div>
    
   
    
     <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E">
  	  优惠券
    </div>
    <div class="drdd-info4" onclick="window.location.href='cartCoupons.html?addr_id=0'" >
    	<p>优惠券</p>
        <a >
        
        
        	0张可使用优惠券
        
        
         <span> ></span></a>
        <div style="clear:both;"></div>
    </div>
    
     <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E">
  	  配送方式
    </div>
    <div class="drdd-info4">
    	<p>配送方式</p>
    	<a href="#">
    	<select id="fgt_price" onchange="fgt()" style="border: 0">
    	<option value="-2">请选择</option>
    	<option value="-1">快递：
    	
    	6.0元
    	 </option>
    	<option value="6.0" style="">免费自提点
    	</option>
    	</select>
        <span>></span></a>
        <div style="clear:both;"></div>
    </div>
    
     <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E;display:none;" id="zitidian-str">
  	  选择自提点
    </div>
    <div class="drdd-info2" style="display:none" id="zitidian-choose" >
    <select id="area_area"  style="border: 0;width: 20%" onchange="choose_area()">
    <option value="-2">请选择区</option>
    
    <option value="33">鼓楼区</option>
    
    <option value="34">玄武区</option>
    
    <option value="35">秦淮区</option>
    
    <option value="44">建邺区</option>
    
    </select>
    <select id="area_addr"  style="border: 0;width:75%">
    <option value="-2">请选择自提点</option>
    </select>
    </div>
    
    <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E">
  	 备注
    </div>
    <div class="drdd-info4">
    	<p>备注：</p>
      
        <input type="text" placeholder="选填，填写您对卖家的要求" id='note' style="width:80%;border:0px">
     
        <div style="clear:both;"></div>
    </div>
     <div style="font-size: 12px;padding-left:5px; margin-top:13px;color: #A09E9E">
  	  订单价格
    </div>
    <div class="drdd-info2">
    
    	<p class="p1 f-l">商品总价</p>
    	<p class="p2 f-r"><span id="">￥0.0</span></p>
        <br>
       
        <p class="p1 f-l">物流费用</p>
    	<p class="p2 f-r"><span id="wuliu">￥6.0</span></p>
        <br>
        
        
        <div style="border-bottom:1px solid #DED9D9;">
         
        </div>
        <p class="p1 f-l">共<span id="tnumStr">0</span>件商品</p>
    	<p class="p2 f-r">总计：<span id="tpriceStr" style="color: #f60">￥6.0</span></p>
        <div style="clear:both;"></div>
    </div>
    <button class="drdd-btn" onclick="add()">确认付款</button>
    <script type="text/javascript">
    
    function fgt(){
    	var wuliu ='6.0';
    	
    	var tprice= '6.0';
    	var fgt_price= $('#fgt_price').val();
    	if(fgt_price!=-2&&fgt_price!=-1){ //选择自提点
    		$('#zitidian-str').show();
    		$('#zitidian-choose').show();
    		wuliu=0;
    	}
    	else{
    		$('#zitidian-str').hide();
    		$('#zitidian-choose').hide();
    		fgt_price=0;
    	}
    
    	$('#wuliu').text('￥'+wuliu);
    //	tprice = tprice - fgt_price;
    	tprice = (parseFloat(tprice)-parseFloat(fgt_price)).toFixed(1);
   		$('#tpriceStr').text('￥'+tprice);
   		$('#tprice').val(tprice);
   		
    }
    </script>
    <script type="text/javascript">
    function choose_area(){
    	var area =$('#area_area').val();
    	
    	$.ajax({
    		url:'areaJson.html',
    		type:'post',
    		data:'level='+area,
    		success :function(rs){
    			$('#area_addr').html("");
    			$('#area_addr').append('<option value="-2">请选择自提点</option>');
    			var data = eval(rs);
    			$.each(data,function(i,item){
    				$('#area_addr').append('<option value='+data[i].area_name+'>'+data[i].area_name+'</option>');
    			})
    		}
    	});
    }
    
    function add(){
    	var goods_id="";
    	var goods_name="";
    	var goods_img="";
    	var goods_price="";
    	var goods_num="";
    	var fgt_price= $('#fgt_price').val();
    	if(fgt_price==-2){
    		showTip("请选择配送方式！");return;
    	}
    	
    	var goods_ids=$("input[name='goods_id']");
    	for (var i = 0; i < goods_ids.length; i++) {
			if (i == 0) {
				goods_id += goods_ids[i].value;
			} else {
				goods_id += ",-=" + goods_ids[i].value;
			}
		}
    	
    	var goods_names=$("input[name='goods_name']") ;
    	for (var i = 0; i < goods_names.length; i++) {
			if (i == 0) {
				goods_name += goods_names[i].value;
			} else {
				goods_name += ",-=" + goods_names[i].value;
			}
		}
    	var goods_imgs =$("input[name='goods_img']");
    	for (var i = 0; i < goods_imgs.length; i++) {
			if (i == 0) {
				goods_img += goods_imgs[i].value;
			} else {
				goods_img += ",-=" + goods_imgs[i].value;
			}
		}
    	var goods_prices=$("input[name='goods_price']") ;
    	for (var i = 0; i < goods_prices.length; i++) {
			if (i == 0) {
				goods_price += goods_prices[i].value;
			} else {
				goods_price += ",-=" + goods_prices[i].value;
			}
		}
    	var goods_nums =$("input[name='goods_num']");
    	for (var i = 0; i < goods_nums.length; i++) {
			if (i == 0) {
				goods_num += goods_nums[i].value;
			} else {
				goods_num += ",-=" + goods_nums[i].value;
			}
		}
    	var goods_total= $('#tprice').val();
    	var goods_total_num= $('#tnum').val();
    	
    	var cps_id= $('#cps_id').val();
    	var cps_name= $('#cps_name').val();
    	var cps_price= $('#cps_price').val();
    	if(typeof(cps_name)=='undefined'){
    		cps_id= '';
    		cps_name= '';
        	cps_price=0;
    	}
    	var receive ="";
    	var addr_user=$('#addr_user').val();
    	var addr_tel=$('#addr_tel').val();
    	var addr_name=$('#addr_name').val();
    	
    	if(typeof(addr_user)=='undefined'){
    		addr_user='';
    	}
    	if(typeof(addr_tel)=='undefined'){
    		addr_tel='';
    	}
    	if(typeof(addr_name)=='undefined'){
    		addr_name='';
    	}
    	
    	if(fgt_price!=-1){
    		var area_area = $('#area_area').val();
    		var area_addr = $('#area_addr').val();
    		if(area_area==-2){
    			showTip('请选择区域');
        		return ;
    		}
			if(area_addr==-2){
				showTip('请选择自提点');
	    		return ;
    		}
    		receive=$('#area_area').find("option:selected").text()+area_addr;
    		
    	}
		
    	if(addr_user==''||addr_tel==''||addr_name==''){
    		showTip('请填写有效的收货地址');
    		return ;
    	}
    	var province =$('#province').text();
		if(province==''){
			showTip("收货地址填写有误，请重新编辑！");return;
		}
		var city =$('#city').text();
		if(city==''){
			showTip("收货地址填写有误，请重新编辑！");return;
		}
		var area =$('#area').text();
		if(area==''){
			showTip("收货地址填写有误，请重新编辑！");return;
		}

		var note= $('#note').val();
    	 addr_name=addr_user+' '+addr_tel+' '+province+' '+city+' '+ area+' '+addr_name;
    	$.ajax({
			url:'orderInsert.html',
			type:'post',
			data:'goods_id='+goods_id
			+'&goods_name='+goods_name
			+'&goods_img='+goods_img
			+'&goods_price='+goods_price
			+'&goods_num='+goods_num
			+'&goods_total='+goods_total
			+'&goods_total_num='+goods_total_num
			+'&cps_id='+cps_id+'&cps_name='+cps_name
			+'&cps_price='+cps_price
			+'&addr_name='+addr_name
			+'&receive='+receive+'&note='+note,
			success:function(rs){
				var re = /^[0-9]+.?[0-9]*$/;    
				if(re.test(rs)&&rs!=0){
					
					window.location.href='payOrder.html?order_id='+rs;
				}else{
					alert("失败！");
				}
			}
		})

    }
    </script>

</body>
</html>
